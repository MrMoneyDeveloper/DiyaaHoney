{% extends 'base.html' %}

{% block title %}Live Hits - DiyaaHoney{% endblock %}

{% block content %}
<h1>Live Connection Hits</h1>
<p>This page shows a continuously updating feed of simulated connection activity.  Every five seconds the
latest data is fetched from the server and displayed below.</p>

<table class="data-table">
    <thead>
        <tr><th>IP Address</th><th>Hits</th></tr>
    </thead>
    <tbody id="hits-body">
        <!-- rows will be inserted here by JavaScript -->
    </tbody>
  </table>

<script>
function fetchHits() {
    fetch('{{ url_for('dashboard.api_hits') }}')
        .then(response => response.json())
        .then(data => {
            const tbody = document.getElementById('hits-body');
            tbody.innerHTML = '';
            data.forEach(item => {
                const tr = document.createElement('tr');
                const tdIp = document.createElement('td');
                tdIp.textContent = item.ip;
                const tdHits = document.createElement('td');
                tdHits.textContent = item.hits;
                tr.appendChild(tdIp);
                tr.appendChild(tdHits);
                tbody.appendChild(tr);
            });
        })
        .catch(err => console.error('Error fetching hits:', err));
}
// initial load and periodic refresh every 5 seconds
fetchHits();
setInterval(fetchHits, 5000);
</script>
{% endblock %}
